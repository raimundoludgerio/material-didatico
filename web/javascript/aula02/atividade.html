<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade Fundamentos</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .user-card {
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .loading {
            display: none;
        }
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 15px;
        }
        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <header class="bg-primary text-white py-4 mb-4 shadow">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h3 mb-0"><i class="fas fa-users me-2"></i>Explorador de Usuários</h1>
                    <p class="mb-0 opacity-75">Consultando API com JavaScript Assíncrono</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <span class="badge bg-light text-primary fs-6">Promises & Async/Await</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Controles -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar usuários por nome, email ou cidade...">
                    <button class="btn btn-outline-secondary" type="button" id="clearSearch">Limpar</button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-primary me-md-2" id="loadUsers">
                        <i class="fas fa-sync-alt me-1"></i> Carregar Usuários
                    </button>
                    <button class="btn btn-outline-secondary" id="clearUsers">
                        <i class="fas fa-trash me-1"></i> Limpar Tudo
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="text-muted">Consultando API e processando dados...</p>
        </div>

        <!-- Área de Status -->
        <div id="statusArea" class="alert alert-info d-none" role="alert">
            <!-- Mensagens de status serão inseridas aqui -->
        </div>

        <!-- Cards de Usuários -->
        <div id="usersContainer" class="row">
            <!-- Os cards serão inseridos aqui via JavaScript -->
        </div>

        <!-- Estatísticas -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="feature-icon text-primary">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div>
                                        <h5 id="totalUsers">0</h5>
                                        <small class="text-muted">Total de Usuários</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="feature-icon text-success">
                                        <i class="fas fa-city"></i>
                                    </div>
                                    <div>
                                        <h5 id="totalCities">0</h5>
                                        <small class="text-muted">Cidades Únicas</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="feature-icon text-warning">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <h5 id="totalCompanies">0</h5>
                                        <small class="text-muted">Empresas</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="feature-icon text-info">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div>
                                        <h5 id="totalWebsites">0</h5>
                                        <small class="text-muted">Websites</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Usuário -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Detalhes do Usuário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="userModalBody">
                    <!-- Conteúdo do modal será inserido aqui -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Atividade Prática</h5>
                    <p class="mb-0">JavaScript: Promises e Programação Assíncrona</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">API utilizada: <a href="https://jsonplaceholder.typicode.com" class="text-white">JSONPlaceholder</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap & Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Código JavaScript da Aplicação -->
    <script>
        // Elementos DOM
        const loadUsersBtn = document.getElementById('loadUsers');
        const clearUsersBtn = document.getElementById('clearUsers');
        const clearSearchBtn = document.getElementById('clearSearch');
        const searchInput = document.getElementById('searchInput');
        const usersContainer = document.getElementById('usersContainer');
        const loadingElement = document.getElementById('loading');
        const statusArea = document.getElementById('statusArea');
        const userModal = new bootstrap.Modal(document.getElementById('userModal'));
        
        // Elementos de estatísticas
        const totalUsersElement = document.getElementById('totalUsers');
        const totalCitiesElement = document.getElementById('totalCities');
        const totalCompaniesElement = document.getElementById('totalCompanies');
        const totalWebsitesElement = document.getElementById('totalWebsites');

        // Estado da aplicação
        let users = [];
        let filteredUsers = [];

        // URL da API
        const API_URL = 'https://jsonplaceholder.typicode.com/users';

        // Função para mostrar/ocultar loading
        function toggleLoading(show) {
            loadingElement.style.display = show ? 'block' : 'none';
        }

        // Função para mostrar mensagens de status
        function showStatus(message, type = 'info') {
            statusArea.textContent = message;
            statusArea.className = `alert alert-${type} ${message ? '' : 'd-none'}`;
        }

        // Função para buscar usuários da API
        async function fetchUsers() {
            try {
                toggleLoading(true);
                showStatus('Conectando com a API...', 'info');
                
                // Simular um pequeno atraso para demonstração
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`Erro na requisição: ${response.status}`);
                }
                
                const data = await response.json();
                showStatus(`${data.length} usuários carregados com sucesso!`, 'success');
                return data;
                
            } catch (error) {
                console.error('Erro ao buscar usuários:', error);
                showStatus(`Falha ao carregar usuários: ${error.message}`, 'danger');
                return [];
            } finally {
                toggleLoading(false);
            }
        }

        // Função para criar o card de um usuário
        function createUserCard(user) {
            const firstLetter = user.name.charAt(0).toUpperCase();
            
            return `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card user-card h-100">
                        <div class="card-body">
                            <div class="avatar">${firstLetter}</div>
                            <h5 class="card-title text-center">${user.name}</h5>
                            <p class="card-text">
                                <i class="fas fa-envelope text-muted me-2"></i>
                                <small>${user.email}</small>
                            </p>
                            <p class="card-text">
                                <i class="fas fa-phone text-muted me-2"></i>
                                <small>${user.phone}</small>
                            </p>
                            <p class="card-text">
                                <i class="fas fa-globe text-muted me-2"></i>
                                <small>${user.website}</small>
                            </p>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm w-100 view-details" data-user-id="${user.id}">
                                    <i class="fas fa-eye me-1"></i> Ver Detalhes
                                </button>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent">
                            <small class="text-muted">
                                <i class="fas fa-building me-1"></i> ${user.company.name}
                            </small>
                        </div>
                    </div>
                </div>
            `;
        }

        // Função para exibir usuários no container
        function displayUsers(usersToDisplay) {
            if (usersToDisplay.length === 0) {
                usersContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">Nenhum usuário encontrado</h4>
                        <p class="text-muted">Tente ajustar sua busca ou carregar os usuários novamente.</p>
                    </div>
                `;
                return;
            }
            
            const usersHTML = usersToDisplay.map(user => createUserCard(user)).join('');
            usersContainer.innerHTML = usersHTML;
            
            // Adicionar event listeners para os botões de detalhes
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-user-id'));
                    showUserDetails(userId);
                });
            });
        }

        // Função para mostrar detalhes do usuário no modal
        function showUserDetails(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const modalBody = document.getElementById('userModalBody');
            const modalTitle = document.getElementById('userModalLabel');
            
            modalTitle.textContent = `Detalhes: ${user.name}`;
            
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-4 text-center mb-3">
                        <div class="avatar mx-auto" style="width: 100px; height: 100px; font-size: 36px;">
                            ${user.name.charAt(0).toUpperCase()}
                        </div>
                        <h5 class="mt-2">${user.name}</h5>
                        <p class="text-muted">@${user.username}</p>
                    </div>
                    <div class="col-md-8">
                        <h6>Informações de Contato</h6>
                        <ul class="list-group list-group-flush mb-3">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-envelope me-2"></i>Email</span>
                                <span>${user.email}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-phone me-2"></i>Telefone</span>
                                <span>${user.phone}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-globe me-2"></i>Website</span>
                                <span>${user.website}</span>
                            </li>
                        </ul>
                        
                        <h6>Endereço</h6>
                        <div class="card mb-3">
                            <div class="card-body py-2">
                                <p class="mb-1">${user.address.street}, ${user.address.suite}</p>
                                <p class="mb-1">${user.address.city} - ${user.address.zipcode}</p>
                                <p class="mb-0">
                                    <small class="text-muted">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        Lat: ${user.address.geo.lat}, Lng: ${user.address.geo.lng}
                                    </small>
                                </p>
                            </div>
                        </div>
                        
                        <h6>Empresa</h6>
                        <div class="card">
                            <div class="card-body py-2">
                                <h6 class="card-title mb-1">${user.company.name}</h6>
                                <p class="card-text mb-1">${user.company.catchPhrase}</p>
                                <p class="card-text mb-0"><small>${user.company.bs}</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            userModal.show();
        }

        // Função para filtrar usuários
        function filterUsers() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredUsers = [...users];
            } else {
                filteredUsers = users.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) ||
                    user.email.toLowerCase().includes(searchTerm) ||
                    user.address.city.toLowerCase().includes(searchTerm) ||
                    user.company.name.toLowerCase().includes(searchTerm)
                );
            }
            
            displayUsers(filteredUsers);
            updateStatistics();
        }

        // Função para atualizar as estatísticas
        function updateStatistics() {
            const usersToCount = filteredUsers.length > 0 ? filteredUsers : users;
            
            totalUsersElement.textContent = usersToCount.length;
            
            // Contar cidades únicas
            const uniqueCities = new Set(usersToCount.map(user => user.address.city));
            totalCitiesElement.textContent = uniqueCities.size;
            
            // Contar empresas únicas
            const uniqueCompanies = new Set(usersToCount.map(user => user.company.name));
            totalCompaniesElement.textContent = uniqueCompanies.size;
            
            // Contar websites
            totalWebsitesElement.textContent = usersToCount.length; // Cada usuário tem um website
        }

        // Função para limpar a busca
        function clearSearch() {
            searchInput.value = '';
            filterUsers();
        }

        // Função para limpar todos os usuários
        function clearAllUsers() {
            users = [];
            filteredUsers = [];
            displayUsers([]);
            updateStatistics();
            showStatus('Todos os usuários foram removidos.', 'warning');
        }

        // Event Listeners
        loadUsersBtn.addEventListener('click', async () => {
            users = await fetchUsers();
            filteredUsers = [...users];
            displayUsers(users);
            updateStatistics();
        });

        clearUsersBtn.addEventListener('click', clearAllUsers);
        clearSearchBtn.addEventListener('click', clearSearch);
        searchInput.addEventListener('input', filterUsers);

        // Inicialização da aplicação
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('Clique em "Carregar Usuários" para buscar dados da API.', 'info');
        });
    </script>
</body>
</html>